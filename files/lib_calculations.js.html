<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/calculations.js - kollavarsham</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <!--<link rel="shortcut icon" type="image/png" href="../assets/favicon.png">-->
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="/kollavarsham-nodejs/"><img src="../assets/img/logo.png" title="kollavarsham"></a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>കൊല്ലവർഷം - node.js API (v0.0.1)</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/calendar.html">calendar</a></li>
            
                <li><a href="../classes/cliHelper.html">cliHelper</a></li>
            
                <li><a href="../classes/globals.html">globals</a></li>
            
                <li><a href="../classes/JulianDate.html">JulianDate</a></li>
            
                <li><a href="../classes/Kollavarsham.html">Kollavarsham</a></li>
            
                <li><a href="../classes/KollavarshamDate.html">KollavarshamDate</a></li>
            
                <li><a href="../classes/locations.html">locations</a></li>
            
                <li><a href="../classes/math.html">math</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/calculations.html">calculations</a></li>
            
                <li><a href="../modules/calendar.html">calendar</a></li>
            
                <li><a href="../modules/cli-helper.html">cli-helper</a></li>
            
                <li><a href="../modules/date.html">date</a></li>
            
                <li><a href="../modules/globals.html">globals</a></li>
            
                <li><a href="../modules/kollavarsham.html">kollavarsham</a></li>
            
                <li><a href="../modules/locations.html">locations</a></li>
            
                <li><a href="../modules/math.html">math</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/calculations.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * kollavarsham
 * http://kollavarsham.org
 *
 * Copyright (c) 2014 The Kollavarsham Team
 * Licensed under the MIT license.
 */

/**
 Calculations involved in the to and fro conversions of Kollavarsham to Gregorian dates and vice versa
 @module calculations
 */

&#x27;use strict&#x27;;

var calendar = require(&#x27;./calendar&#x27;);
var celestial = require(&#x27;./celestial&#x27;);
var globals = require(&#x27;./globals&#x27;);
var math = require(&#x27;./math&#x27;);

var calculations = {
  setConstants : function (settings) {
    // TODO: Add Tests if/when feasible
    celestial.setPrimaryConstants();
    if (settings.bija) {
      celestial.applyBija();
    }
    celestial.setSecondaryConstants();
    celestial.setPlanetaryConstants();
  },
  main         : function (settings) {
    // TODO: Add Tests if/when feasible
    this.setConstants(settings);
    // This is how it is done in Perl - we use the new gregorianDate global
    //globals.JulianDay = calendar.gregorianDateToJulianDay(new Date(globals.year, globals.month - 1, globals.day));
    globals.JulianDay = calendar.gregorianDateToJulianDay(globals.gregorianDate);
    globals.ahar = calendar.julianDayToAhargana(globals.JulianDay);
    globals.JulianDay = math.truncate(globals.JulianDay + 0.5);
    globals.ahargana = math.truncate(globals.ahar + 0.5);
    globals.weekdayName = calendar.julianDayToWeekday(globals.JulianDay);
    celestial.setAyanamsa(globals.ahargana);

    // at 6 o&#x27;clock
    globals.ahar += 0.25;

    // desantara
    globals.ahar -= globals.desantara;

    // time of sunrise at local latitude
    globals.eqtime = celestial.getDaylightEquation(globals.year, settings.latitude);
    globals.ahar -= globals.eqtime;
    celestial.setSunriseTime(globals.eqtime);

    // Lunar apogee and node at sunrise
    celestial.PlanetMeanPosition.Candrocca = celestial.getMeanLongitude(globals.ahar, celestial.YugaRotation.Candrocca) + 90;
    celestial.PlanetMeanPosition.Candrocca = celestial.zero360(celestial.PlanetMeanPosition.Candrocca);

    celestial.PlanetMeanPosition.Rahu = celestial.getMeanLongitude(globals.ahar, celestial.YugaRotation.Rahu) + 180;
    celestial.PlanetMeanPosition.Rahu = celestial.zero360(celestial.PlanetMeanPosition.Rahu);

    // mean and true sun at sunrise
    globals.mslong = celestial.getMeanLongitude(globals.ahar, celestial.YugaRotation.sun);
    celestial.PlanetMeanPosition.sun = globals.mslong;
    globals.tslong = celestial.zero360(globals.mslong -
        celestial.getMandaEquation((globals.mslong - celestial.PlanetApogee.sun), &#x27;sun&#x27;));
    celestial.PlanetMeanPosition.sun = globals.tslong;

    // mean and true moon at sunrise
    globals.mllong = celestial.getMeanLongitude(globals.ahar, celestial.YugaRotation.moon);
    celestial.YugaRotation.moon = globals.mllong;
    celestial.PlanetApogee.moon = celestial.PlanetMeanPosition.Candrocca;
    globals.tllong = celestial.zero360(globals.mllong -
        celestial.getMandaEquation(( globals.mllong - celestial.PlanetApogee.moon), &#x27;moon&#x27;));
    celestial.PlanetTruePosition.moon = globals.tllong;

    // finding tithi and longitude of conjunction
    globals.tithi = celestial.getTithi(globals.tllong, globals.tslong);
    celestial.setTithiSet(globals.tithi);
    celestial.setSuklaKrsna();

    // last conjunction
    globals.clong = celestial.getClong(globals.ahar, globals.tithi);

    // next conjunction
    globals.nclong = celestial.getNclong(globals.ahar, globals.tithi);

    globals.adhimasa = calendar.getAdhimasa(globals.clong, globals.nclong);
    globals.masaNum = calendar.getMasaNum(globals.tslong, globals.clong);
    globals.masa = calendar.getMasaName(globals.masaNum);

    var sauraMasaMonthDay = calendar.getSauraMasaMonthDay(globals.ahar);
    globals.sauraMasaNum = sauraMasaMonthDay.month;
    globals.sauraMasaDay = sauraMasaMonthDay.day;
    globals.sauraMasa = calendar.getSauraMasaName(globals.sauraMasaNum);

    globals.malayalaMasaNum = (globals.sauraMasaNum - 4 + 12 ) % 12;
    globals.malayalaMasa = calendar.getMalayalaMasaName(globals.malayalaMasaNum);

    globals.naksatra = calendar.getNaksatraName(globals.tllong);
    globals.malayalaNaksatra = calendar.getMalayalaNaksatraName(globals.tllong);

    // kali and Saka era
    globals.YearKali = calendar.aharganaToKali(globals.ahar + ( 4 - globals.masaNum ) * 30);
    globals.YearSaka = calendar.kaliToSaka(globals.YearKali);
    globals.YearVikrama = globals.YearSaka + 135;
    globals.MalayalamYear = globals.YearSaka - 747 +
        math.truncate((globals.sauraMasaNum - globals.malayalaMasaNum + 12) / 12);
    //globals.MEYear = globals.;
  },
  planetary    : function () {
    var planets = [&#x27;mercury&#x27;, &#x27;venus&#x27;, &#x27;mars&#x27;, &#x27;jupiter&#x27;, &#x27;saturn&#x27;];
    for (var i = 0; i &lt; planets.length; i++) {
      celestial.PlanetMeanPosition[planets[i]] = celestial.getMeanLongitude(globals.ahar, celestial.PlanetRotation[planets[i]]);
      celestial.PlanetTruePosition[planets[i]] = celestial.getTrueLongitude(globals.ahar, globals.mslong, planets[i]);
    }
  }
};

module.exports = calculations;
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<footer id="footer">
  <span class="copyright"><a href="/LICENSE.txt">&copy; 2014 The Kollavarsham Team</a></span>
  <a href="/" id="footer-back"><span>Back to kollavarsham.org</span></a>
  <span class="last-modified">Last Updated: Mon, 17 Feb 2014 22:30:44 GMT</span>
</footer>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-4869398-6', 'kollavarsham.org');
  ga('send', 'pageview');

</script>
</body>
</html>
