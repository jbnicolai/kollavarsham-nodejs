<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/calendar.js - kollavarsham</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <!--<link rel="shortcut icon" type="image/png" href="../assets/favicon.png">-->
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="/kollavarsham-nodejs/"><img src="../assets/img/logo.png" title="kollavarsham"></a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>കൊല്ലവർഷം - node.js API (v0.0.1)</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/calendar.html">calendar</a></li>
            
                <li><a href="../classes/cliHelper.html">cliHelper</a></li>
            
                <li><a href="../classes/globals.html">globals</a></li>
            
                <li><a href="../classes/JulianDate.html">JulianDate</a></li>
            
                <li><a href="../classes/Kollavarsham.html">Kollavarsham</a></li>
            
                <li><a href="../classes/KollavarshamDate.html">KollavarshamDate</a></li>
            
                <li><a href="../classes/locations.html">locations</a></li>
            
                <li><a href="../classes/math.html">math</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/calculations.html">calculations</a></li>
            
                <li><a href="../modules/calendar.html">calendar</a></li>
            
                <li><a href="../modules/cli-helper.html">cli-helper</a></li>
            
                <li><a href="../modules/date.html">date</a></li>
            
                <li><a href="../modules/globals.html">globals</a></li>
            
                <li><a href="../modules/kollavarsham.html">kollavarsham</a></li>
            
                <li><a href="../modules/locations.html">locations</a></li>
            
                <li><a href="../modules/math.html">math</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/calendar.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * kollavarsham
 * http://kollavarsham.org
 *
 * Copyright (c) 2014 The Kollavarsham Team
 * Licensed under the MIT license.
 */

/**
 * @module calendar
 */
&#x27;use strict&#x27;;

var celestial = require(&#x27;./celestial&#x27;);
var globals = require(&#x27;./globals&#x27;);
var math = require(&#x27;./math&#x27;);
var JulianDate = require(&#x27;./date&#x27;).JulianDate;

/**
 * @class calendar
 * @static
 * @type {{weekdays: {0: string, 1: string, 2: string, 3: string, 4: string, 5: string, 6: string}, months: {January: number, February: number, March: number, April: number, May: number, June: number, July: number, August: number, September: number, October: number, November: number, December: number}, masaNames: {0: string, 1: string, 2: string, 3: string, 4: string, 5: string, 6: string, 7: string, 8: string, 9: string, 10: string, 11: string}, sauraMasaNames: {0: string, 1: string, 2: string, 3: string, 4: string, 5: string, 6: string, 7: string, 8: string, 9: string, 10: string, 11: string}, naksatras: {0: string, 1: string, 2: string, 3: string, 4: string, 5: string, 6: string, 7: string, 8: string, 9: string, 10: string, 11: string, 12: string, 13: string, 14: string, 15: string, 16: string, 17: string, 18: string, 19: string, 20: string, 21: string, 22: string, 23: string, 24: string, 25: string, 26: string, 27: string}, nextDate: nextDate, gregorianDateToJulianDay: gregorianDateToJulianDay, julianInEngland: julianInEngland, julianDayToJulianDate: julianDayToJulianDate, julianDayToGregorianDate: julianDayToGregorianDate, julianDayToModernDate: julianDayToModernDate, julianDayToAhargana: julianDayToAhargana, aharganaToJulianDay: aharganaToJulianDay, aharganaToKali: aharganaToKali, kaliToSaka: kaliToSaka, julianDayToWeekday: julianDayToWeekday, getAdhimasa: getAdhimasa, getMasaNum: getMasaNum, getMasaName: getMasaName, findSamkranti: findSamkranti, setSamkranti: setSamkranti, isTodaySauraMasaFirst: isTodaySauraMasaFirst, getSauraMasaMonthDay: getSauraMasaMonthDay, getSauraMasaName: getSauraMasaName, getNaksatraName: getNaksatraName}}
 */
var calendar = {
  weekdays                 : {
    0 : &#x27;Monday&#x27;,
    1 : &#x27;Tuesday&#x27;,
    2 : &#x27;Wednesday&#x27;,
    3 : &#x27;Thursday&#x27;,
    4 : &#x27;Friday&#x27;,
    5 : &#x27;Saturday&#x27;,
    6 : &#x27;Sunday&#x27;
  },
  months                   : {
    &#x27;January&#x27;   : 0,
    &#x27;February&#x27;  : 1,
    &#x27;March&#x27;     : 2,
    &#x27;April&#x27;     : 3,
    &#x27;May&#x27;       : 4,
    &#x27;June&#x27;      : 5,
    &#x27;July&#x27;      : 6,
    &#x27;August&#x27;    : 7,
    &#x27;September&#x27; : 8,
    &#x27;October&#x27;   : 9,
    &#x27;November&#x27;  : 10,
    &#x27;December&#x27;  : 11
  },
  masaNames                : {
    0  : &#x27;Caitra    &#x27;,
    1  : &#x27;Vaisakha  &#x27;,
    2  : &#x27;Jyaistha  &#x27;,
    3  : &#x27;Asadha    &#x27;,
    4  : &#x27;Sravana   &#x27;,
    5  : &#x27;Bhadrapada&#x27;,
    6  : &#x27;Asvina    &#x27;,
    7  : &#x27;Karttika  &#x27;,
    8  : &#x27;Margasirsa&#x27;,
    9  : &#x27;Pausa     &#x27;,
    10 : &#x27;Magha     &#x27;,
    11 : &#x27;Phalguna  &#x27;
  },
  sauraMasaNames           : {
    0  : &#x27;Mesa      &#x27;,
    1  : &#x27;Vrsa      &#x27;,
    2  : &#x27;Mithuna   &#x27;,
    3  : &#x27;Karkata   &#x27;,
    4  : &#x27;Simha     &#x27;,
    5  : &#x27;Kanya     &#x27;,
    6  : &#x27;Tula      &#x27;,
    7  : &#x27;Vrscika   &#x27;,
    8  : &#x27;Dhanus    &#x27;,
    9  : &#x27;Makara    &#x27;,
    10 : &#x27;Kumbha    &#x27;,
    11 : &#x27;Mina      &#x27;
  },
  malayalaMasaNames        : {
    0  : &#x27;Chingam   &#x27;,
    1  : &#x27;Kanni     &#x27;,
    2  : &#x27;Thulam    &#x27;,
    3  : &#x27;Vrischikam&#x27;,
    4  : &#x27;Dhanu     &#x27;,
    5  : &#x27;Makaram   &#x27;,
    6  : &#x27;Kumbham   &#x27;,
    7  : &#x27;Meenam    &#x27;,
    8  : &#x27;Medam     &#x27;,
    9  : &#x27;Idavam    &#x27;,
    10 : &#x27;Mithunam  &#x27;,
    11 : &#x27;Karkitakam&#x27;
  },
  naksatras                : {
    0  : &#x27;Asvini&#x27;,
    1  : &#x27;Bharani&#x27;,
    2  : &#x27;Krttika&#x27;,
    3  : &#x27;Rohini&#x27;,
    4  : &#x27;Mrgasira&#x27;,
    5  : &#x27;Ardra&#x27;,
    6  : &#x27;Punarvasu&#x27;,
    7  : &#x27;Pusya&#x27;,
    8  : &#x27;Aslesa&#x27;,
    9  : &#x27;Magha&#x27;,
    10 : &#x27;P-phalguni&#x27;,
    11 : &#x27;U-phalguni&#x27;,
    12 : &#x27;Hasta&#x27;,
    13 : &#x27;Citra&#x27;,
    14 : &#x27;Svati&#x27;,
    15 : &#x27;Visakha&#x27;,
    16 : &#x27;Anuradha&#x27;,
    17 : &#x27;Jyestha&#x27;,
    18 : &#x27;Mula&#x27;,
    19 : &#x27;P-asadha&#x27;,
    20 : &#x27;U-asadha&#x27;,
    21 : &#x27;Sravana&#x27;,
    22 : &#x27;Dhanistha&#x27;,
    23 : &#x27;Satabhisaj&#x27;,
    24 : &#x27;P-bhadrapada&#x27;,
    25 : &#x27;U-bhadrapada&#x27;,
    26 : &#x27;Revati&#x27;,
    27 : &#x27;Asvini&#x27;
  },
  malayalaNaksatras        : {
    0  : &#x27;Ashwathi&#x27;,
    1  : &#x27;Bharani&#x27;,
    2  : &#x27;Karthika&#x27;,
    3  : &#x27;Rohini&#x27;,
    4  : &#x27;Makiryam&#x27;,
    5  : &#x27;Thiruvathira&#x27;,
    6  : &#x27;Punartham&#x27;,
    7  : &#x27;Pooyam&#x27;,
    8  : &#x27;Aayilyam&#x27;,
    9  : &#x27;Makam&#x27;,
    10 : &#x27;Pooram&#x27;,
    11 : &#x27;Uthram&#x27;,
    12 : &#x27;Atham&#x27;,
    13 : &#x27;Chithra&#x27;,
    14 : &#x27;Chothi&#x27;,
    15 : &#x27;Vishakham&#x27;,
    16 : &#x27;Anizham&#x27;,
    17 : &#x27;Thrikketta&#x27;,
    18 : &#x27;Moolam&#x27;,
    19 : &#x27;Pooradam&#x27;,
    20 : &#x27;Uthradam&#x27;,
    21 : &#x27;Thiruvonam&#x27;,
    22 : &#x27;Avittam&#x27;,
    23 : &#x27;Chathayam&#x27;,
    24 : &#x27;Poororuttathi&#x27;,
    25 : &#x27;Uthrattathi&#x27;,
    26 : &#x27;Revathi&#x27;,
    27 : &#x27;Ashwathi&#x27;
  },
  nextDate                 : function (date) {
    date.setUTCDate(date.getUTCDate() + 1);
    return date;
  },
  gregorianDateToJulianDay : function (date) {
    //  TODO:
    // Annotate all the magic numbers below !
    // There is some explanation here - http://quasar.as.utexas.edu/BillInfo/JulianDatesG.html

    var year = date.getFullYear(),
        month = date.getMonth() + 1,
        day = date.getDate();

    if (month &lt; 3) {
      year -= 1;
      month += 12;
    }

    var julianDay = math.truncate(365.25 * year) + math.truncate(30.59 * (month - 2)) + day + 1721086.5;

    if (year &lt; 0) {
      julianDay -= 1;
      if (year % 4 === 0 &amp;&amp; 3 &lt;= month) {
        julianDay += 1;
      }
    }

    if (2299160 &lt; julianDay) {
      julianDay += (math.truncate(year / 400) - math.truncate(year / 100) + 2);
    }

    return julianDay;
  },
  julianInEngland          : function (julianDay) {
    // Gregorian calendar was first introduced in most of Europe in 1582,
    // but it wasn&#x27;t adopted in England (and so in US and Canada) until 1752
    //
    // - http://www.timeanddate.com/calendar/julian-gregorian-switch.html
    //
    // This function returns true between
    //      October 14th, 1582 and September 14th, 1752, both dates exclusive
    return 2299160 &lt; julianDay &amp;&amp; julianDay &lt;= 2361221;
  },
  julianDayToJulianDate    : function (julianDay) {
    var j, k, l, n, i, J, I, year, month, day;

    j = math.truncate(julianDay) + 1402;
    k = math.truncate((j - 1) / 1461);
    l = j - 1461 * k;
    n = math.truncate((l - 1) / 365) - math.truncate(l / 1461);
    i = l - 365 * n + 30;
    J = math.truncate(80 * i / 2447);
    I = math.truncate(J / 11);

    day = i - math.truncate(2447 * J / 80);
    month = J + 2 - 12 * I;
    year = 4 * k + n + I - 4716;

    return new JulianDate(year, month, day);
  },
  julianDayToGregorianDate : function (julianDay) {
    var a, b, c, e, f, g, h, year, month, day;

    a = julianDay + 68569;
    b = math.truncate(a / 36524.25);
    c = a - math.truncate(36524.25 * b + 0.75);
    e = math.truncate((c + 1) / 365.2425);
    f = c - math.truncate(365.25 * e) + 31;
    g = math.truncate(f / 30.59);
    h = math.truncate(g / 11);

    day = math.truncate(f - math.truncate(30.59 * g) + (julianDay - math.truncate(julianDay)));
    month = math.truncate(g - 12 * h + 2);
    year = math.truncate(100 * (b - 49) + e + h);

    var result = new Date(year, month - 1, day);
    if (year &gt; 0 &amp;&amp; year &lt;= 99) {
      result.setFullYear(year);
    }
    return  result;
  },
  julianDayToModernDate    : function (julianDay) {
    return julianDay &lt; 2299239 ? this.julianDayToJulianDate(julianDay) : this.julianDayToGregorianDate(julianDay);
  },
  julianDayToAhargana      : function (julianDay) {
    return julianDay - 588465.50;
  },
  aharganaToJulianDay      : function (ahargana) {
    return 588465.50 + ahargana;
  },
  aharganaToKali           : function (ahargana) {
    return math.truncate(ahargana * celestial.YugaRotation.sun / globals.YugaCivilDays);
  },
  kaliToSaka               : function (yearKali) {
    return yearKali - 3179;
  },
  julianDayToWeekday       : function (julianDay) {
    return this.weekdays[math.truncate(julianDay + 0.5) % 7];
  },
  getAdhimasa              : function (clong, nclong) {
    return math.floatingPointEqual(math.truncate(clong / 30), math.truncate(nclong / 30), false) ? &#x27;Adhika-&#x27; : &#x27;&#x27;;
  },
  getMasaNum               : function (tslong, clong) {
    var masaNum = math.truncate(tslong / 30) % 12;
    if (masaNum === math.truncate(clong / 30) % 12) {
      masaNum += 1;
    }
    masaNum = (masaNum + 12) % 12;
    return masaNum;
  },
  getMasaName              : function (masaNum) {
    return this.masaNames[masaNum];
  },
  findSamkranti            : function (leftAhargana, rightAhargana) {
    /* The below block seems to be redundant   */
    /* --- START REDUNDANT ------------------- */
    var leftTslong = celestial.getTslong(leftAhargana);
    var rightTslong = celestial.getTslong(rightAhargana);

    leftTslong -= math.truncate(leftTslong / 30) * 30;
    rightTslong -= math.truncate(rightTslong / 30) * 30;
    /* --- END   REDUNDANT ------------------- */

    var width = (rightAhargana - leftAhargana) / 2;
    var centreAhargana = (rightAhargana + leftAhargana) / 2;

    if (width &lt; math.epsilon) {
      return centreAhargana;
    } else {
      var centreTslong = celestial.getTslong(centreAhargana);
      centreTslong -= math.truncate(centreTslong / 30) * 30;
      if (centreTslong &lt; 5) {
        return this.findSamkranti(leftAhargana, centreAhargana);
      } else {
        return this.findSamkranti(centreAhargana, rightAhargana);
      }
    }
  },
  setSamkranti             : function (ahargana) {
    globals.samkranti = this.findSamkranti(ahargana, ahargana + 1) + globals.desantara;
    var samkrantiModernDate = this.julianDayToModernDate(this.aharganaToJulianDay(globals.samkranti));
    if (JulianDate.prototype.isPrototypeOf(samkrantiModernDate)) {
      globals.samkrantiYear = samkrantiModernDate.year;
      globals.samkrantiMonth = samkrantiModernDate.month;
      globals.samkrantiDay = samkrantiModernDate.day;
    } else {
      globals.samkrantiYear = samkrantiModernDate.getFullYear();
      globals.samkrantiMonth = samkrantiModernDate.getMonth() + 1;
      globals.samkrantiDay = samkrantiModernDate.getDate();
    }
    var fractionalDay = math.fractional(globals.samkranti) * 24;
    globals.samkrantiHour = math.truncate(fractionalDay);
    globals.samkrantiMin = math.truncate(60 * math.fractional(fractionalDay));
  },
  isTodaySauraMasaFirst    : function (ahargana) {
    /*
    //    Definition of the first day
    //    samkranti is between today&#x27;s 0:00 and 24:00
    //    ==
    //    at 0:00 before 30x, at 24:00 after 30x
    */
    var tslongToday = celestial.getTslong(ahargana - globals.desantara);
    var tslongTomorrow = celestial.getTslong(ahargana - globals.desantara + 1);

    tslongToday -= math.truncate(tslongToday / 30) * 30;
    tslongTomorrow -= math.truncate(tslongTomorrow / 30) * 30;

    if (25 &lt; tslongToday &amp;&amp; tslongTomorrow &lt; 5) {
      this.setSamkranti(ahargana);
      return true;
    }

    return false;
  },
  getSauraMasaMonthDay     : function (ahargana) {
    // If today is the first day then 1
    // Otherwise yesterday&#x27;s + 1
    var month, day;
    ahargana = math.truncate(ahargana);
    if (this.isTodaySauraMasaFirst(ahargana)) {
      day = 1;
      var tsLongTomorrow = celestial.getTslong(ahargana + 1);
      month = math.truncate(tsLongTomorrow / 30) % 12;
      month = (month + 12) % 12;
    } else {
      var sauraMasaMonthDay = this.getSauraMasaMonthDay(ahargana - 1);
      month = sauraMasaMonthDay.month;
      day = sauraMasaMonthDay.day + 1;
    }
    return {month : month, day : day};
  },
  getSauraMasaName         : function (number) {
    return this.sauraMasaNames[number];
  },
  getMalayalaMasaName      : function (number) {
    return this.malayalaMasaNames[number];
  },
  getNaksatraName          : function (tllong) {
    return this.naksatras[math.truncate(tllong * 27 / 360)];
  },
  getMalayalaNaksatraName  : function (tllong) {
    return this.malayalaNaksatras[math.truncate(tllong * 27 / 360)];
  }
};

module.exports = calendar;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<footer id="footer">
  <span class="copyright"><a href="/LICENSE.txt">&copy; 2014 The Kollavarsham Team</a></span>
  <a href="/" id="footer-back"><span>Back to kollavarsham.org</span></a>
  <span class="last-modified">Last Updated: Mon, 17 Feb 2014 22:30:44 GMT</span>
</footer>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-4869398-6', 'kollavarsham.org');
  ga('send', 'pageview');

</script>
</body>
</html>
